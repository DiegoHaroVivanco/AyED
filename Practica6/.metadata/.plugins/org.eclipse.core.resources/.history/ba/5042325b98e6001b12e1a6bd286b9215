package Parcial;

import ListasGenericas.ListaEnlazadaGenerica;
import ListasGenericas.ListaGenerica;
import tp06.Arista;
import tp06.Grafo;
import tp06.Vertice;

public class Parcial {
	
	public ListaGenerica<String> resolver(Grafo<String> ciudades, String origen, String destino, int rutaObligatoria){
		ListaGenerica<String> camino = new ListaEnlazadaGenerica<String>();
		ListaGenerica<String> caminoMin = new ListaEnlazadaGenerica<String>();
		Vertice<String> v;
		
		// busco origen
		v = buscarOrigen(ciudades, origen);
		if(v != null) {
			Boolean pasoPorRuta = false;
			boolean[] marca = new boolean[ciudades.listaDeVertices().tamanio()+1];
			dfs(v.getPosicion(), camino,caminoMin, marca, ciudades, destino, rutaObligatoria, pasoPorRuta);
		}
		return camino;	
	}
		
	private void dfs(int pos, ListaGenerica<String> l, ListaGenerica<String> lAux,boolean[]marca, Grafo<String> g, String destino, int ruta, Boolean pasoPorRuta) {
		
		marca[pos] = true;
		Vertice<String> v = g.vetice(pos);
		lAux.agregarFinal(v.dato());
		if((v.dato().equals(destino)) && (pasoPorRuta) && (l.tamanio() > lAux.tamanio()) || (l.esVacia())) {
			// elimino todos los elementos de la lista
			l.comenzar();
			while(!l.fin()) {
				l.eliminar(l.proximo());
			}
			// iterar en la lista auxiliar y agregar cada elemento a la lista "l"
			lAux.comenzar();
			while(!lAux.fin()) {
				l.agregarFinal(lAux.proximo());
			}
		}else {
			ListaGenerica<Arista<String>> ady = g.listaDeAdyacentes(v);
			ady.comenzar();
			while(!ady.fin()) {
				Arista<String> a = ady.proximo();
				int i = a.verticeDestino().getPosicion();
				if(!marca[i]) {
					if(a.peso() == ruta) {
						pasoPorRuta = true; 
						dfs(i, l, lAux, marca, g, destino, ruta, pasoPorRuta);
					}else {
						dfs(i, l, lAux, marca, g, destino, ruta, pasoPorRuta);
					}
				}
			}
			
		}
		// dejo todo como estaba
		marca[pos] = false;
		lAux.eliminarEn(lAux.tamanio());

	}
	
	private Vertice<String> buscarOrigen(Grafo<String> g, String origen) {
		ListaGenerica<Vertice<String>> v =  g.listaDeVertices();
		Vertice<String> vAux = null;
		v.comenzar();
		while(!v.fin()) {
			vAux = v.proximo();
			if(vAux.dato().equals(origen)) {
				return vAux;
			}
		}
		return vAux;
	}
	
}
